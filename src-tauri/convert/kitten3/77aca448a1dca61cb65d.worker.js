!function(t){var s={};function i(e){if(s[e])return s[e].exports;var r=s[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=s,i.d=function(t,s,e){i.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var r in t)i.d(e,r,function(s){return t[s]}.bind(null,r));return e},i.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.p="/",i(i.s=1)}([function(t,s,i){var e=e||{REVISION:"ALPHA"};!function(t){"use strict";var s=!1,i=0,e=function(){if(s)return s=!1,i;var t=2*Math.random()-1,r=2*Math.random()-1,a=t*t+r*r;if(0==a||a>1)return e();var o=Math.sqrt(-2*Math.log(a)/a);return i=r*o,s=!0,t*o},r=function(t,s){return Math.random()*(s-t)+t},a=function(t,s){for(var i=0,e=t.length;i<e;i++)if(t[i]===s)return!0;return!1};t.randf=r,t.randi=function(t,s){return Math.floor(Math.random()*(s-t)+t)},t.randn=function(t,s){return t+e()*s},t.zeros=function(t){if(void 0===t||isNaN(t))return[];if("undefined"==typeof ArrayBuffer){for(var s=new Array(t),i=0;i<t;i++)s[i]=0;return s}return new Float64Array(t)},t.maxmin=function(t){if(0===t.length)return{};for(var s=t[0],i=t[0],e=0,r=0,a=t.length,o=1;o<a;o++)t[o]>s&&(s=t[o],e=o),t[o]<i&&(i=t[o],r=o);return{maxi:e,maxv:s,mini:r,minv:i,dv:s-i}},t.randperm=function(t){for(var s,i=t,e=0,r=[],a=0;a<t;a++)r[a]=a;for(;i--;)e=Math.floor(Math.random()*(i+1)),s=r[i],r[i]=r[e],r[e]=s;return r},t.weightedSample=function(t,s){for(var i=r(0,1),e=0,a=0,o=t.length;a<o;a++)if(i<(e+=s[a]))return t[a]},t.arrUnique=function(t){for(var s=[],i=0,e=t.length;i<e;i++)a(s,t[i])||s.push(t[i]);return s},t.arrContains=a,t.getopt=function(t,s,i){return void 0!==t[s]?t[s]:i}}(e),function(t){"use strict";var s=function(s,i,e,r){if("[object Array]"===Object.prototype.toString.call(s)){this.sx=1,this.sy=1,this.depth=s.length,this.w=t.zeros(this.depth),this.dw=t.zeros(this.depth);for(var a=0;a<this.depth;a++)this.w[a]=s[a]}else{this.sx=s,this.sy=i,this.depth=e;var o=s*i*e;if(this.w=t.zeros(o),this.dw=t.zeros(o),void 0===r){var h=Math.sqrt(1/(s*i*e));for(a=0;a<o;a++)this.w[a]=t.randn(0,h)}else for(a=0;a<o;a++)this.w[a]=r}};s.prototype={get:function(t,s,i){var e=(this.sx*s+t)*this.depth+i;return this.w[e]},set:function(t,s,i,e){var r=(this.sx*s+t)*this.depth+i;this.w[r]=e},add:function(t,s,i,e){var r=(this.sx*s+t)*this.depth+i;this.w[r]+=e},get_grad:function(t,s,i){var e=(this.sx*s+t)*this.depth+i;return this.dw[e]},set_grad:function(t,s,i,e){var r=(this.sx*s+t)*this.depth+i;this.dw[r]=e},add_grad:function(t,s,i,e){var r=(this.sx*s+t)*this.depth+i;this.dw[r]+=e},cloneAndZero:function(){return new s(this.sx,this.sy,this.depth,0)},clone:function(){for(var t=new s(this.sx,this.sy,this.depth,0),i=this.w.length,e=0;e<i;e++)t.w[e]=this.w[e];return t},addFrom:function(t){for(var s=0;s<this.w.length;s++)this.w[s]+=t.w[s]},addFromScaled:function(t,s){for(var i=0;i<this.w.length;i++)this.w[i]+=s*t.w[i]},setConst:function(t){for(var s=0;s<this.w.length;s++)this.w[s]=t},toJSON:function(){var t={};return t.sx=this.sx,t.sy=this.sy,t.depth=this.depth,t.w=this.w,t},fromJSON:function(s){this.sx=s.sx,this.sy=s.sy,this.depth=s.depth;var i=this.sx*this.sy*this.depth;this.w=t.zeros(i),this.dw=t.zeros(i);for(var e=0;e<i;e++)this.w[e]=s.w[e]}},t.Vol=s}(e),function(t){"use strict";var s=t.Vol;t.augment=function(i,e,r,a,o){if(void 0===o)o=!1;if(void 0===r)r=t.randi(0,i.sx-e);if(void 0===a)a=t.randi(0,i.sy-e);var h;if(e!==i.sx||0!==r||0!==a){h=new s(e,e,i.depth,0);for(var n=0;n<e;n++)for(var u=0;u<e;u++)if(!(n+r<0||n+r>=i.sx||u+a<0||u+a>=i.sy))for(var _=0;_<i.depth;_++)h.set(n,u,_,i.get(n+r,u+a,_))}else h=i;if(o){var d=h.cloneAndZero();for(n=0;n<h.sx;n++)for(u=0;u<h.sy;u++)for(_=0;_<h.depth;_++)d.set(n,u,_,h.get(h.sx-n-1,u,_));h=d}return h},t.img_to_vol=function(t,i){if(void 0===i)i=!1;var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var r=e.getContext("2d");try{r.drawImage(t,0,0)}catch(t){if("NS_ERROR_NOT_AVAILABLE"===t.name)return!1;throw t}try{var a=r.getImageData(0,0,e.width,e.height)}catch(t){if("IndexSizeError"===t.name)return!1;throw t}for(var o=a.data,h=t.width,n=t.height,u=[],_=0;_<o.length;_++)u.push(o[_]/255-.5);var d=new s(h,n,4,0);if(d.w=u,i){var l=new s(h,n,1,0);for(_=0;_<h;_++)for(var p=0;p<n;p++)l.set(_,p,0,d.get(_,p,0));d=l}return d}}(e),function(t){"use strict";var s=t.Vol,i=function(t){t=t||{};this.out_depth=t.filters,this.sx=t.sx,this.in_depth=t.in_depth,this.in_sx=t.in_sx,this.in_sy=t.in_sy,this.sy=void 0!==t.sy?t.sy:this.sx,this.stride=void 0!==t.stride?t.stride:1,this.pad=void 0!==t.pad?t.pad:0,this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:0,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.out_sx=Math.floor((this.in_sx+2*this.pad-this.sx)/this.stride+1),this.out_sy=Math.floor((this.in_sy+2*this.pad-this.sy)/this.stride+1),this.layer_type="conv";var i=void 0!==t.bias_pref?t.bias_pref:0;this.filters=[];for(var e=0;e<this.out_depth;e++)this.filters.push(new s(this.sx,this.sy,this.in_depth));this.biases=new s(1,1,this.out_depth,i)};i.prototype={forward:function(t,i){this.in_act=t;for(var e=new s(this.out_sx,this.out_sy,this.out_depth,0),r=0;r<this.out_depth;r++)for(var a=this.filters[r],o=-this.pad,h=-this.pad,n=0;n<this.out_sx;o+=this.stride,n++){h=-this.pad;for(var u=0;u<this.out_sy;h+=this.stride,u++){for(var _=0,d=0;d<a.sx;d++)for(var l=0;l<a.sy;l++)for(var p=0;p<a.depth;p++){var c=h+l,f=o+d;c>=0&&c<t.sy&&f>=0&&f<t.sx&&(_+=a.w[(a.sx*l+d)*a.depth+p]*t.w[(t.sx*c+f)*t.depth+p])}_+=this.biases.w[r],e.set(n,u,r,_)}}return this.out_act=e,this.out_act},backward:function(){var s=this.in_act;s.dw=t.zeros(s.w.length);for(var i=0;i<this.out_depth;i++)for(var e=this.filters[i],r=-this.pad,a=-this.pad,o=0;o<this.out_sx;r+=this.stride,o++){a=-this.pad;for(var h=0;h<this.out_sy;a+=this.stride,h++){for(var n=this.out_act.get_grad(o,h,i),u=0;u<e.sx;u++)for(var _=0;_<e.sy;_++)for(var d=0;d<e.depth;d++){var l=a+_,p=r+u;if(l>=0&&l<s.sy&&p>=0&&p<s.sx){var c=(s.sx*l+p)*s.depth+d,f=(e.sx*_+u)*e.depth+d;e.dw[f]+=s.w[c]*n,s.dw[c]+=e.w[f]*n}}this.biases.dw[i]+=n}}},getParamsAndGrads:function(){for(var t=[],s=0;s<this.out_depth;s++)t.push({params:this.filters[s].w,grads:this.filters[s].dw,l2_decay_mul:this.l2_decay_mul,l1_decay_mul:this.l1_decay_mul});return t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),t},toJSON:function(){var t={};t.sx=this.sx,t.sy=this.sy,t.stride=this.stride,t.in_depth=this.in_depth,t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.l1_decay_mul=this.l1_decay_mul,t.l2_decay_mul=this.l2_decay_mul,t.pad=this.pad,t.filters=[];for(var s=0;s<this.filters.length;s++)t.filters.push(this.filters[s].toJSON());return t.biases=this.biases.toJSON(),t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.sx=t.sx,this.sy=t.sy,this.stride=t.stride,this.in_depth=t.in_depth,this.filters=[],this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:1,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.pad=void 0!==t.pad?t.pad:0;for(var i=0;i<t.filters.length;i++){var e=new s(0,0,0,0);e.fromJSON(t.filters[i]),this.filters.push(e)}this.biases=new s(0,0,0,0),this.biases.fromJSON(t.biases)}};var e=function(t){t=t||{};this.out_depth=void 0!==t.num_neurons?t.num_neurons:t.filters,this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:0,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_sx=1,this.out_sy=1,this.layer_type="fc";var i=void 0!==t.bias_pref?t.bias_pref:0;this.filters=[];for(var e=0;e<this.out_depth;e++)this.filters.push(new s(1,1,this.num_inputs));this.biases=new s(1,1,this.out_depth,i)};e.prototype={forward:function(t,i){this.in_act=t;for(var e=new s(1,1,this.out_depth,0),r=t.w,a=0;a<this.out_depth;a++){for(var o=0,h=this.filters[a].w,n=0;n<this.num_inputs;n++)o+=r[n]*h[n];o+=this.biases.w[a],e.w[a]=o}return this.out_act=e,this.out_act},backward:function(){var s=this.in_act;s.dw=t.zeros(s.w.length);for(var i=0;i<this.out_depth;i++){for(var e=this.filters[i],r=this.out_act.dw[i],a=0;a<this.num_inputs;a++)s.dw[a]+=e.w[a]*r,e.dw[a]+=s.w[a]*r;this.biases.dw[i]+=r}},getParamsAndGrads:function(){for(var t=[],s=0;s<this.out_depth;s++)t.push({params:this.filters[s].w,grads:this.filters[s].dw,l1_decay_mul:this.l1_decay_mul,l2_decay_mul:this.l2_decay_mul});return t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),t},toJSON:function(){var t={};t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t.l1_decay_mul=this.l1_decay_mul,t.l2_decay_mul=this.l2_decay_mul,t.filters=[];for(var s=0;s<this.filters.length;s++)t.filters.push(this.filters[s].toJSON());return t.biases=this.biases.toJSON(),t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs,this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:1,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.filters=[];for(var i=0;i<t.filters.length;i++){var e=new s(0,0,0,0);e.fromJSON(t.filters[i]),this.filters.push(e)}this.biases=new s(0,0,0,0),this.biases.fromJSON(t.biases)}},t.ConvLayer=i,t.FullyConnLayer=e}(e),function(t){"use strict";var s=t.Vol,i=function(s){s=s||{};this.sx=s.sx,this.in_depth=s.in_depth,this.in_sx=s.in_sx,this.in_sy=s.in_sy,this.sy=void 0!==s.sy?s.sy:this.sx,this.stride=void 0!==s.stride?s.stride:2,this.pad=void 0!==s.pad?s.pad:0,this.out_depth=this.in_depth,this.out_sx=Math.floor((this.in_sx+2*this.pad-this.sx)/this.stride+1),this.out_sy=Math.floor((this.in_sy+2*this.pad-this.sy)/this.stride+1),this.layer_type="pool",this.switchx=t.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=t.zeros(this.out_sx*this.out_sy*this.out_depth)};i.prototype={forward:function(t,i){this.in_act=t;for(var e=new s(this.out_sx,this.out_sy,this.out_depth,0),r=0,a=0;a<this.out_depth;a++)for(var o=-this.pad,h=-this.pad,n=0;n<this.out_sx;o+=this.stride,n++){h=-this.pad;for(var u=0;u<this.out_sy;h+=this.stride,u++){for(var _=-99999,d=-1,l=-1,p=0;p<this.sx;p++)for(var c=0;c<this.sy;c++){var f=h+c,y=o+p;if(f>=0&&f<t.sy&&y>=0&&y<t.sx){var v=t.get(y,f,a);v>_&&(_=v,d=y,l=f)}}this.switchx[r]=d,this.switchy[r]=l,r++,e.set(n,u,a,_)}}return this.out_act=e,this.out_act},backward:function(){var s=this.in_act;s.dw=t.zeros(s.w.length);this.out_act;for(var i=0,e=0;e<this.out_depth;e++){this.pad,this.pad;for(var r=0;r<this.out_sx;this.stride,r++){-this.pad;for(var a=0;a<this.out_sy;this.stride,a++){var o=this.out_act.get_grad(r,a,e);s.add_grad(this.switchx[i],this.switchy[i],e,o),i++}}}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.sx=this.sx,t.sy=this.sy,t.stride=this.stride,t.in_depth=this.in_depth,t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.pad=this.pad,t},fromJSON:function(s){this.out_depth=s.out_depth,this.out_sx=s.out_sx,this.out_sy=s.out_sy,this.layer_type=s.layer_type,this.sx=s.sx,this.sy=s.sy,this.stride=s.stride,this.in_depth=s.in_depth,this.pad=void 0!==s.pad?s.pad:0,this.switchx=t.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=t.zeros(this.out_sx*this.out_sy*this.out_depth)}},t.PoolLayer=i}(e),function(t){"use strict";t.Vol;var s=function(t){t=t||{};this.out_sx=void 0!==t.out_sx?t.out_sx:t.in_sx,this.out_sy=void 0!==t.out_sy?t.out_sy:t.in_sy,this.out_depth=void 0!==t.out_depth?t.out_depth:t.in_depth,this.layer_type="input"};s.prototype={forward:function(t,s){return this.in_act=t,this.out_act=t,this.out_act},backward:function(){},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},t.InputLayer=s}(e),function(t){"use strict";var s=t.Vol,i=function(t){t=t||{};this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="softmax"};i.prototype={forward:function(i,e){this.in_act=i;for(var r=new s(1,1,this.out_depth,0),a=i.w,o=i.w[0],h=1;h<this.out_depth;h++)a[h]>o&&(o=a[h]);var n=t.zeros(this.out_depth),u=0;for(h=0;h<this.out_depth;h++){var _=Math.exp(a[h]-o);u+=_,n[h]=_}for(h=0;h<this.out_depth;h++)n[h]/=u,r.w[h]=n[h];return this.es=n,this.out_act=r,this.out_act},backward:function(s){var i=this.in_act;i.dw=t.zeros(i.w.length);for(var e=0;e<this.out_depth;e++){var r=-((e===s?1:0)-this.es[e]);i.dw[e]=r}return-Math.log(this.es[s])},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs}};var e=function(t){t=t||{};this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="regression"};e.prototype={forward:function(t,s){return this.in_act=t,this.out_act=t,t},backward:function(s){var i=this.in_act;i.dw=t.zeros(i.w.length);var e=0;if(s instanceof Array||s instanceof Float64Array)for(var r=0;r<this.out_depth;r++){var a=i.w[r]-s[r];i.dw[r]=a,e+=2*a*a}else{r=s.dim;var o=s.val;a=i.w[r]-o;i.dw[r]=a,e+=2*a*a}return e},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs}};var r=function(t){t=t||{};this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="svm"};r.prototype={forward:function(t,s){return this.in_act=t,this.out_act=t,t},backward:function(s){var i=this.in_act;i.dw=t.zeros(i.w.length);for(var e=i.w[s],r=0,a=0;a<this.out_depth;a++)-e+i.w[a]+1>0&&(i.dw[a]+=1,i.dw[s]-=1,r+=-e+i.w[a]+1);return r},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs}},t.RegressionLayer=e,t.SoftmaxLayer=i,t.SVMLayer=r}(e),function(t){"use strict";var s=t.Vol,i=function(t){t=t||{};this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="relu"};i.prototype={forward:function(t,s){this.in_act=t;for(var i=t.clone(),e=t.w.length,r=i.w,a=0;a<e;a++)r[a]<0&&(r[a]=0);return this.out_act=i,this.out_act},backward:function(){var s=this.in_act,i=this.out_act,e=s.w.length;s.dw=t.zeros(e);for(var r=0;r<e;r++)i.w[r]<=0?s.dw[r]=0:s.dw[r]=i.dw[r]},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}};var e=function(t){t=t||{};this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="sigmoid"};e.prototype={forward:function(t,s){this.in_act=t;for(var i=t.cloneAndZero(),e=t.w.length,r=i.w,a=t.w,o=0;o<e;o++)r[o]=1/(1+Math.exp(-a[o]));return this.out_act=i,this.out_act},backward:function(){var s=this.in_act,i=this.out_act,e=s.w.length;s.dw=t.zeros(e);for(var r=0;r<e;r++){var a=i.w[r];s.dw[r]=a*(1-a)*i.dw[r]}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}};var r=function(s){s=s||{};this.group_size=void 0!==s.group_size?s.group_size:2,this.out_sx=s.in_sx,this.out_sy=s.in_sy,this.out_depth=Math.floor(s.in_depth/this.group_size),this.layer_type="maxout",this.switches=t.zeros(this.out_sx*this.out_sy*this.out_depth)};r.prototype={forward:function(t,i){this.in_act=t;var e=this.out_depth,r=new s(this.out_sx,this.out_sy,this.out_depth,0);if(1===this.out_sx&&1===this.out_sy)for(var a=0;a<e;a++){for(var o=a*this.group_size,h=t.w[o],n=0,u=1;u<this.group_size;u++){(p=t.w[o+u])>h&&(h=p,n=u)}r.w[a]=h,this.switches[a]=o+n}else for(var _=0,d=0;d<t.sx;d++)for(var l=0;l<t.sy;l++)for(a=0;a<e;a++){for(o=a*this.group_size,h=t.get(d,l,o),n=0,u=1;u<this.group_size;u++){var p;(p=t.get(d,l,o+u))>h&&(h=p,n=u)}r.set(d,l,a,h),this.switches[_]=o+n,_++}return this.out_act=r,this.out_act},backward:function(){var s=this.in_act,i=this.out_act,e=this.out_depth;if(s.dw=t.zeros(s.w.length),1===this.out_sx&&1===this.out_sy)for(var r=0;r<e;r++){var a=i.dw[r];s.dw[this.switches[r]]=a}else for(var o=0,h=0;h<i.sx;h++)for(var n=0;n<i.sy;n++)for(r=0;r<e;r++){a=i.get_grad(h,n,r);s.set_grad(h,n,this.switches[o],a),o++}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.group_size=this.group_size,t},fromJSON:function(s){this.out_depth=s.out_depth,this.out_sx=s.out_sx,this.out_sy=s.out_sy,this.layer_type=s.layer_type,this.group_size=s.group_size,this.switches=t.zeros(this.group_size)}};var a=function(t){t=t||{};this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="tanh"};a.prototype={forward:function(t,s){this.in_act=t;for(var i,e,r=t.cloneAndZero(),a=t.w.length,o=0;o<a;o++)r.w[o]=(i=t.w[o],e=void 0,((e=Math.exp(2*i))-1)/(e+1));return this.out_act=r,this.out_act},backward:function(){var s=this.in_act,i=this.out_act,e=s.w.length;s.dw=t.zeros(e);for(var r=0;r<e;r++){var a=i.w[r];s.dw[r]=(1-a*a)*i.dw[r]}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},t.TanhLayer=a,t.MaxoutLayer=r,t.ReluLayer=i,t.SigmoidLayer=e}(e),function(t){"use strict";t.Vol;var s=function(s){s=s||{};this.out_sx=s.in_sx,this.out_sy=s.in_sy,this.out_depth=s.in_depth,this.layer_type="dropout",this.drop_prob=void 0!==s.drop_prob?s.drop_prob:.5,this.dropped=t.zeros(this.out_sx*this.out_sy*this.out_depth)};s.prototype={forward:function(t,s){this.in_act=t,void 0===s&&(s=!1);var i=t.clone(),e=t.w.length;if(s)for(var r=0;r<e;r++)Math.random()<this.drop_prob?(i.w[r]=0,this.dropped[r]=!0):this.dropped[r]=!1;else for(r=0;r<e;r++)i.w[r]*=this.drop_prob;return this.out_act=i,this.out_act},backward:function(){var s=this.in_act,i=this.out_act,e=s.w.length;s.dw=t.zeros(e);for(var r=0;r<e;r++)this.dropped[r]||(s.dw[r]=i.dw[r])},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.drop_prob=this.drop_prob,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.drop_prob=t.drop_prob}},t.DropoutLayer=s}(e),function(t){"use strict";t.Vol;var s=function(t){t=t||{};this.k=t.k,this.n=t.n,this.alpha=t.alpha,this.beta=t.beta,this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="lrn",this.n%2==0&&console.log("WARNING n should be odd for LRN layer")};s.prototype={forward:function(t,s){this.in_act=t;var i=t.cloneAndZero();this.S_cache_=t.cloneAndZero();for(var e=Math.floor(this.n/2),r=0;r<t.sx;r++)for(var a=0;a<t.sy;a++)for(var o=0;o<t.depth;o++){for(var h=t.get(r,a,o),n=0,u=Math.max(0,o-e);u<=Math.min(o+e,t.depth-1);u++){var _=t.get(r,a,u);n+=_*_}n*=this.alpha/this.n,n+=this.k,this.S_cache_.set(r,a,o,n),n=Math.pow(n,this.beta),i.set(r,a,o,h/n)}return this.out_act=i,this.out_act},backward:function(){var s=this.in_act;s.dw=t.zeros(s.w.length);this.out_act;for(var i=Math.floor(this.n/2),e=0;e<s.sx;e++)for(var r=0;r<s.sy;r++)for(var a=0;a<s.depth;a++)for(var o=this.out_act.get_grad(e,r,a),h=this.S_cache_.get(e,r,a),n=Math.pow(h,this.beta),u=n*n,_=Math.max(0,a-i);_<=Math.min(a+i,s.depth-1);_++){var d=s.get(e,r,_),l=-d*this.beta*Math.pow(h,this.beta-1)*this.alpha/this.n*2*d;_===a&&(l+=n),l/=u,l*=o,s.add_grad(e,r,_,l)}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.k=this.k,t.n=this.n,t.alpha=this.alpha,t.beta=this.beta,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.out_depth=this.out_depth,t.layer_type=this.layer_type,t},fromJSON:function(t){this.k=t.k,this.n=t.n,this.alpha=t.alpha,this.beta=t.beta,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.out_depth=t.out_depth,this.layer_type=t.layer_type}},t.LocalResponseNormalizationLayer=s}(e),function(t){"use strict";var s=t.Vol,i=function(t){t=t||{};this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth+t.in_depth*t.in_depth,this.layer_type="quadtransform"};i.prototype={forward:function(t,i){this.in_act=t;for(var e=this.out_depth,r=t.depth,a=new s(this.out_sx,this.out_sy,this.out_depth,0),o=0;o<t.sx;o++)for(var h=0;h<t.sy;h++)for(var n=0;n<e;n++)if(n<r)a.set(o,h,n,t.get(o,h,n));else{var u=Math.floor((n-r)/r),_=n-r-u*r;a.set(o,h,n,t.get(o,h,u)*t.get(o,h,_))}return this.out_act=a,this.out_act},backward:function(){var s=this.in_act;s.dw=t.zeros(s.w.length);for(var i=this.out_act,e=this.out_depth,r=s.depth,a=0;a<s.sx;a++)for(var o=0;o<s.sy;o++)for(var h=0;h<e;h++){var n=i.get_grad(a,o,h);if(h<r)s.add_grad(a,o,h,n);else{var u=Math.floor((h-r)/r),_=h-r-u*r;s.add_grad(a,o,u,s.get(a,o,_)*n),s.add_grad(a,o,_,s.get(a,o,u)*n)}}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},t.QuadTransformLayer=i}(e),function(t){"use strict";t.Vol;var s=function(t){this.layers=[]};s.prototype={makeLayers:function(s){s.length<2&&console.log("ERROR! For now at least have input and softmax layers."),"input"!==s[0].type&&console.log("ERROR! For now first layer should be input.");s=function(){for(var t=[],i=0;i<s.length;i++){var e=s[i];if("softmax"!==e.type&&"svm"!==e.type||t.push({type:"fc",num_neurons:e.num_classes}),"regression"===e.type&&t.push({type:"fc",num_neurons:e.num_neurons}),"fc"!==e.type&&"conv"!==e.type||void 0!==e.bias_pref||(e.bias_pref=0,void 0!==e.activation&&"relu"===e.activation&&(e.bias_pref=.1)),void 0!==e.tensor&&e.tensor&&t.push({type:"quadtransform"}),t.push(e),void 0!==e.activation)if("relu"===e.activation)t.push({type:"relu"});else if("sigmoid"===e.activation)t.push({type:"sigmoid"});else if("tanh"===e.activation)t.push({type:"tanh"});else if("maxout"===e.activation){var r="undefined"!==e.group_size?e.group_size:2;t.push({type:"maxout",group_size:r})}else console.log("ERROR unsupported activation "+e.activation);void 0!==e.drop_prob&&"dropout"!==e.type&&t.push({type:"dropout",drop_prob:e.drop_prob})}return t}(),this.layers=[];for(var i=0;i<s.length;i++){var e=s[i];if(i>0){var r=this.layers[i-1];e.in_sx=r.out_sx,e.in_sy=r.out_sy,e.in_depth=r.out_depth}switch(e.type){case"fc":this.layers.push(new t.FullyConnLayer(e));break;case"lrn":this.layers.push(new t.LocalResponseNormalizationLayer(e));break;case"dropout":this.layers.push(new t.DropoutLayer(e));break;case"input":this.layers.push(new t.InputLayer(e));break;case"softmax":this.layers.push(new t.SoftmaxLayer(e));break;case"regression":this.layers.push(new t.RegressionLayer(e));break;case"conv":this.layers.push(new t.ConvLayer(e));break;case"pool":this.layers.push(new t.PoolLayer(e));break;case"relu":this.layers.push(new t.ReluLayer(e));break;case"sigmoid":this.layers.push(new t.SigmoidLayer(e));break;case"tanh":this.layers.push(new t.TanhLayer(e));break;case"maxout":this.layers.push(new t.MaxoutLayer(e));break;case"quadtransform":this.layers.push(new t.QuadTransformLayer(e));break;case"svm":this.layers.push(new t.SVMLayer(e));break;default:console.log("ERROR: UNRECOGNIZED LAYER TYPE!")}}},forward:function(t,s){void 0===s&&(s=!1);for(var i=this.layers[0].forward(t,s),e=1;e<this.layers.length;e++)i=this.layers[e].forward(i,s);return i},backward:function(t){for(var s=this.layers.length,i=this.layers[s-1].backward(t),e=s-2;e>=0;e--)this.layers[e].backward();return i},getParamsAndGrads:function(){for(var t=[],s=0;s<this.layers.length;s++)for(var i=this.layers[s].getParamsAndGrads(),e=0;e<i.length;e++)t.push(i[e]);return t},getPrediction:function(){for(var t=this.layers[this.layers.length-1].out_act.w,s=t[0],i=0,e=1;e<t.length;e++)t[e]>s&&(s=t[e],i=e);return i},toJSON:function(){for(var t={layers:[]},s=0;s<this.layers.length;s++)t.layers.push(this.layers[s].toJSON());return t},fromJSON:function(s){this.layers=[];for(var i=0;i<s.layers.length;i++){var e,r=s.layers[i],a=r.layer_type;"input"===a&&(e=new t.InputLayer),"relu"===a&&(e=new t.ReluLayer),"sigmoid"===a&&(e=new t.SigmoidLayer),"tanh"===a&&(e=new t.TanhLayer),"dropout"===a&&(e=new t.DropoutLayer),"conv"===a&&(e=new t.ConvLayer),"pool"===a&&(e=new t.PoolLayer),"lrn"===a&&(e=new t.LocalResponseNormalizationLayer),"softmax"===a&&(e=new t.SoftmaxLayer),"regression"===a&&(e=new t.RegressionLayer),"fc"===a&&(e=new t.FullyConnLayer),"maxout"===a&&(e=new t.MaxoutLayer),"quadtransform"===a&&(e=new t.QuadTransformLayer),"svm"===a&&(e=new t.SVMLayer),e.fromJSON(r),this.layers.push(e)}}},t.Net=s}(e),function(t){"use strict";t.Vol;var s=function(t,s){this.net=t;s=s||{};this.learning_rate=void 0!==s.learning_rate?s.learning_rate:.01,this.l1_decay=void 0!==s.l1_decay?s.l1_decay:0,this.l2_decay=void 0!==s.l2_decay?s.l2_decay:0,this.batch_size=void 0!==s.batch_size?s.batch_size:1,this.method=void 0!==s.method?s.method:"sgd",this.momentum=void 0!==s.momentum?s.momentum:.9,this.ro=void 0!==s.ro?s.ro:.95,this.eps=void 0!==s.eps?s.eps:1e-6,this.k=0,this.gsum=[],this.xsum=[]};s.prototype={train:function(s,i){var e=(new Date).getTime();this.net.forward(s,!0);var r=(new Date).getTime()-e,a=(e=(new Date).getTime(),this.net.backward(i)),o=0,h=0,n=(new Date).getTime()-e;if(this.k++,this.k%this.batch_size==0){var u=this.net.getParamsAndGrads();if(0===this.gsum.length&&("sgd"!==this.method||this.momentum>0))for(var _=0;_<u.length;_++)this.gsum.push(t.zeros(u[_].params.length)),"adadelta"===this.method?this.xsum.push(t.zeros(u[_].params.length)):this.xsum.push([]);for(_=0;_<u.length;_++)for(var d=u[_],l=d.params,p=d.grads,c=void 0!==d.l2_decay_mul?d.l2_decay_mul:1,f=void 0!==d.l1_decay_mul?d.l1_decay_mul:1,y=this.l2_decay*c,v=this.l1_decay*f,m=l.length,w=0;w<m;w++){o+=y*l[w]*l[w]/2,h+=v*Math.abs(l[w]);var x=v*(l[w]>0?1:-1),g=(y*l[w]+x+p[w])/this.batch_size,b=this.gsum[_],S=this.xsum[_];if("adagrad"===this.method){b[w]=b[w]+g*g;var z=-this.learning_rate/Math.sqrt(b[w]+this.eps)*g;l[w]+=z}else if("windowgrad"===this.method){b[w]=this.ro*b[w]+(1-this.ro)*g*g;z=-this.learning_rate/Math.sqrt(b[w]+this.eps)*g;l[w]+=z}else if("adadelta"===this.method){b[w]=this.ro*b[w]+(1-this.ro)*g*g;z=-Math.sqrt((S[w]+this.eps)/(b[w]+this.eps))*g;S[w]=this.ro*S[w]+(1-this.ro)*z*z,l[w]+=z}else if(this.momentum>0){z=this.momentum*b[w]-this.learning_rate*g;b[w]=z,l[w]+=z}else l[w]+=-this.learning_rate*g;p[w]=0}}return{fwd_time:r,bwd_time:n,l2_decay_loss:o,l1_decay_loss:h,cost_loss:a,softmax_loss:a,loss:a+h+o}}},t.Trainer=s,t.SGDTrainer=s}(e),function(t){"use strict";var s=t.randf,i=t.randi,r=t.Net,a=t.Trainer,o=t.maxmin,h=t.randperm,n=t.weightedSample,u=t.getopt,_=t.arrUnique,d=function(t,s,i){i=i||{};void 0===t&&(t=[]),void 0===s&&(s=[]),this.data=t,this.labels=s,this.train_ratio=u(i,"train_ratio",.7),this.num_folds=u(i,"num_folds",10),this.num_candidates=u(i,"num_candidates",50),this.num_epochs=u(i,"num_epochs",50),this.ensemble_size=u(i,"ensemble_size",10),this.batch_size_min=u(i,"batch_size_min",10),this.batch_size_max=u(i,"batch_size_max",300),this.l2_decay_min=u(i,"l2_decay_min",-4),this.l2_decay_max=u(i,"l2_decay_max",2),this.learning_rate_min=u(i,"learning_rate_min",-4),this.learning_rate_max=u(i,"learning_rate_max",0),this.momentum_min=u(i,"momentum_min",.9),this.momentum_max=u(i,"momentum_max",.9),this.neurons_min=u(i,"neurons_min",5),this.neurons_max=u(i,"neurons_max",30),this.folds=[],this.candidates=[],this.evaluated_candidates=[],this.unique_labels=_(s),this.iter=0,this.foldix=0,this.finish_fold_callback=null,this.finish_batch_callback=null,this.data.length>0&&(this.sampleFolds(),this.sampleCandidates())};d.prototype={sampleFolds:function(){var t=this.data.length,s=Math.floor(this.train_ratio*t);this.folds=[];for(var i=0;i<this.num_folds;i++){var e=h(t);this.folds.push({train_ix:e.slice(0,s),test_ix:e.slice(s,t)})}},sampleCandidate:function(){var t=this.data[0].w.length,e=this.unique_labels.length,o=[];o.push({type:"input",out_sx:1,out_sy:1,out_depth:t});for(var h=n([0,1,2,3],[.2,.3,.3,.2]),u=0;u<h;u++){var _=i(this.neurons_min,this.neurons_max),d=["tanh","maxout","relu"][i(0,3)];if(s(0,1)<.5){var l=Math.random();o.push({type:"fc",num_neurons:_,activation:d,drop_prob:l})}else o.push({type:"fc",num_neurons:_,activation:d})}o.push({type:"softmax",num_classes:e});var p=new r;p.makeLayers(o);var c,f=i(this.batch_size_min,this.batch_size_max),y=Math.pow(10,s(this.l2_decay_min,this.l2_decay_max)),v=Math.pow(10,s(this.learning_rate_min,this.learning_rate_max)),m=s(this.momentum_min,this.momentum_max),w=s(0,1),x=new a(p,c=w<.33?{method:"adadelta",batch_size:f,l2_decay:y}:w<.66?{method:"adagrad",learning_rate:v,batch_size:f,l2_decay:y}:{method:"sgd",learning_rate:v,momentum:m,batch_size:f,l2_decay:y}),g={acc:[],accv:0};return g.layer_defs=o,g.trainer_def=c,g.net=p,g.trainer=x,g},sampleCandidates:function(){this.candidates=[];for(var t=0;t<this.num_candidates;t++){var s=this.sampleCandidate();this.candidates.push(s)}},step:function(){this.iter++;for(var t=this.folds[this.foldix],s=t.train_ix[i(0,t.train_ix.length)],e=0;e<this.candidates.length;e++){var o=this.data[s],h=this.labels[s];this.candidates[e].trainer.train(o,h)}var n=this.num_epochs*t.train_ix.length;if(this.iter>=n){var u=this.evalValErrors();for(e=0;e<this.candidates.length;e++){(_=this.candidates[e]).acc.push(u[e]),_.accv+=u[e]}if(this.iter=0,this.foldix++,null!==this.finish_fold_callback&&this.finish_fold_callback(),this.foldix>=this.folds.length){for(e=0;e<this.candidates.length;e++)this.evaluated_candidates.push(this.candidates[e]);this.evaluated_candidates.sort((function(t,s){return t.accv/t.acc.length>s.accv/s.acc.length?-1:1})),this.evaluated_candidates.length>3*this.ensemble_size&&(this.evaluated_candidates=this.evaluated_candidates.slice(0,3*this.ensemble_size)),null!==this.finish_batch_callback&&this.finish_batch_callback(),this.sampleCandidates(),this.foldix=0}else for(e=0;e<this.candidates.length;e++){var _=this.candidates[e],d=new r;d.makeLayers(_.layer_defs);var l=new a(d,_.trainer_def);_.net=d,_.trainer=l}}},evalValErrors:function(){for(var t=[],s=this.folds[this.foldix],i=0;i<this.candidates.length;i++){for(var e=this.candidates[i].net,r=0,a=0;a<s.test_ix.length;a++){var o=this.data[s.test_ix[a]],h=this.labels[s.test_ix[a]];e.forward(o),r+=e.getPrediction()===h?1:0}r/=s.test_ix.length,t.push(r)}return t},predict_soft:function(t){var s,i,r=Math.min(this.ensemble_size,this.evaluated_candidates.length);if(0===r)return new e.Vol(0,0,0);for(var a=0;a<r;a++){var o=this.evaluated_candidates[a].net.forward(t);if(0===a)s=o,i=o.w.length;else for(var h=0;h<i;h++)s.w[h]+=o.w[h]}for(h=0;h<i;h++)s.w[h]/=i;return s},predict:function(t){var s=this.predict_soft(t);if(0!==s.w.length)var i=o(s.w).maxi;else i=-1;return i},toJSON:function(){for(var t=Math.min(this.ensemble_size,this.evaluated_candidates.length),s={nets:[]},i=0;i<t;i++)s.nets.push(this.evaluated_candidates[i].net.toJSON());return s},fromJSON:function(t){this.ensemble_size=t.nets.length,this.evaluated_candidates=[];for(var s=0;s<this.ensemble_size;s++){var i=new r;i.fromJSON(t.nets[s]);var e={};e.net=i,this.evaluated_candidates.push(e)}},onFinishFold:function(t){this.finish_fold_callback=t},onFinishBatch:function(t){this.finish_batch_callback=t}},t.MagicNet=d}(e),function(s){"use strict";void 0===t.exports?window.jsfeat=s:t.exports=s}(e)},function(t,s,i){"use strict";i.r(s);var e=i(0),r=[-5,5],a=self,o=self.postMessage;a.addEventListener("message",(function(t){var s=JSON.parse(t.data),i={};switch(s.type){case"train":var a=new e.Net;a.fromJSON(s.model);var h=s.input,n=s.output,u=s.max,_=s.min,d=[];u.forEach((function(t,s){d[s]=t-_[s]}));for(var l=h.length,p=new e.Vol(1,1,l),c=new e.Trainer(a,{method:"adagrad",l2_decay:.001,l1_decay:.001,batch_size:20}),f=0;f<20;f++)for(var y=0;y<h.length;y++){for(var v=[],m=0;m<h[y].length;m++)0!=d[m]?v[m]=(h[y][m]-_[m])/d[m]*10-5:v[m]=h[y][m];p.w=v,c.train(p,n[y])}i.net=a.toJSON(),i.type="train",i.id=s.id,o(i);break;case"draw":var w=new e.Net;w.fromJSON(s.model);for(var x=(r[1]-r[0])/50,g=[],b=0,S=r[0];S<r[1];S=Number((S+x).toFixed(1))){g[b]=[];for(var z=function(t){var i=new e.Vol([S,t]),r=w.forward(i),a=0,o=1/r.w.length,h=o;s.is_simple_mode?h=.8:(r.w.forEach((function(t,s){t>o&&(a=s,h=t)})),h=(h-o)/(1-o)),g[b].unshift({class_index:a,density:h})},N=r[0];N<r[1];N=Number((N+x).toFixed(1)))z(N);b++}i.output_data=g,i.type="draw",i.id=s.id,o(i)}}))}]);